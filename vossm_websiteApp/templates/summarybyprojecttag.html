<!DOCTYPE html>
<html>
  <head>
    <title> Summary Software </title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="http://www.amcharts.com/lib/3/serial.js"></script>
    <script src="http://www.amcharts.com/lib/3/themes/light.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
      .chartdiv {
        width       : 100%;
        height      : 500px;
        font-size   : 11px;
      }                    
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script type="text/javascript">
		function leaveChange() {

			packageName = document.getElementById("packages").value;
		    document.getElementById("message").innerHTML = packageName;

		    $.ajax({
		         type:"POST",
		         url:'/DBOperation/',
		         data: {
		                'operation': 'getData', 
		                'packageName': packageName
		                },
		         success: function(response){
		            if (response!=undefined)
		            {
		            	//Draw system (windows/linux) chart
		            	var chartData = [];
		            	for(var key in response['system']){
				          	var attrValue = response['system'][key];
		            		chartData.push({
				            	  name: key,
				              	  occur: attrValue
				          	});
		            	}
		            	chartDraw("systemChartDiv", chartData)

		            	//draw version for packages chart
						var chartData = [];
		            	for(var key in response['version']){
				          	var attrValue = response['version'][key];
		            		chartData.push({
				            	  name: key,
				              	  occur: attrValue
				          	});
		            	}
		            	chartDraw("versionChartDiv", chartData)

		            	//draw hardware chart
						chartData = [];
		            	for(var key in response['hardware']){
				          	var attrValue = response['hardware'][key];
		            		chartData.push({
				            	  name: key,
				              	  occur: attrValue
				          	});
		            	}
		            	chartDraw("hardwareChartDiv", chartData)
		            }  
		         }
		  	});
		}

		function chartDraw(divname, chartData)
		{
			AmCharts.makeChart( divname, {
			  "type": "serial",
			  "theme": "light",
			  "dataProvider": chartData,
			  "valueAxes": [ {
			    "gridColor": "#FFFFFF",
			    "gridAlpha": 0.2,
			    "dashLength": 0
			  } ],
			  "gridAboveGraphs": true,
			  "startDuration": 1,
			  "graphs": [ {
			    "balloonText": "[[name]]: <b>[[occur]]</b>",
			    "fillAlphas": 0.8,
			    "lineAlpha": 0.2,
			    "type": "column",
			    "valueField": "occur"
			  } ],
			  "chartCursor": {
			    "categoryBalloonEnabled": false,
			    "cursorAlpha": 0,
			    "zoomable": false
			  },
			  "categoryField": "name",
			  "categoryAxis": {
			    "gridPosition": "start",
			    "gridAlpha": 0,
			    "tickPosition": "start",
			    "tickLength": 20
			  },
			  "export": {
			    "enabled": true
			  }
			});

		}
	</script>
   </head>
 <body>
 	{% include 'index.html' %}
 	<div class="page-header">
      <h2>Summary By Project Tag</h2>
    </div>
    <div class="container-fluid">
	  <div class="col-xs-12 col-sm-12 content">
    		<div class="row row-plan-offcanvas row-offcanvas row-offcanvas-left">
			    <select id = "packages" class="form-control" onchange="leaveChange()">
			    	{% for key,value in data.items %}
				    	<option value={{ value.package }}>{{ value.package }}</option>
				    {% endfor %}
				</select>
			</div>
			<div id="message"></div>
		</div>
	</div>
	<div class="chartdiv" id="systemChartDiv"></div>
	<div class="chartdiv" id="versionChartDiv"></div>
	<div class="chartdiv" id="hardwareChartDiv"></div>

 </body>
 </html>