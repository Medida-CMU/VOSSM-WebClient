<!DOCTYPE html>
<html>
  <head>
    <title> Manage Peers </title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="http://www.amcharts.com/lib/3/serial.js"></script>
    <script src="http://www.amcharts.com/lib/3/themes/light.js"></script>

    <style>
      #chartdiv {
        width       : 100%;
        height      : 500px;
        font-size   : 11px;
      }                    
    </style>
    {% load jsonify %}
    <script type="text/javascript">
      val = {{ data|jsonify }}
      var chartData = [];

      for(var key in val){
          var attrName = key;
          var attrValue = val[key];
          
          console.log(attrValue['package'])
          chartData.push({
              name: attrValue['package'],
              occur: attrValue['occurences']
          });
      }

      console.log(chartData)

var chart = AmCharts.makeChart( "chartdiv", {
  "type": "serial",
  "theme": "light",
  "dataProvider": chartData,
  "valueAxes": [ {
    "gridColor": "#FFFFFF",
    "gridAlpha": 0.2,
    "dashLength": 0
  } ],
  "gridAboveGraphs": true,
  "startDuration": 1,
  "graphs": [ {
    "balloonText": "[[name]]: <b>[[occur]]</b>",
    "fillAlphas": 0.8,
    "lineAlpha": 0.2,
    "type": "column",
    "valueField": "occur"
  } ],
  "chartCursor": {
    "categoryBalloonEnabled": false,
    "cursorAlpha": 0,
    "zoomable": false
  },
  "categoryField": "name",
  "categoryAxis": {
    "gridPosition": "start",
    "gridAlpha": 0,
    "tickPosition": "start",
    "tickLength": 20
  },
  "export": {
    "enabled": true
  }

} );

    console.log("adssad")
    function saveChanges () {
      var checkedVal = []
      var uncheckedVal = []
     $("input:checkbox[name=chkData]:checked").each(function(){
        checkedVal.push($(this).val());
      });
      $("input:checkbox[name=chkData]:not(:checked)").each(function(){
        uncheckedVal.push($(this).val());
      });

     // console.log(checkedVal);
       $.ajax({
        type: "POST",
        url: "/update_config/",
        data: { 'checkedVal': JSON.stringify(checkedVal), 'uncheckedVal': JSON.stringify(uncheckedVal)}
        }).done(function( o ) {
            alert("Done");
           });
      }

    </script> 

  </head>
 <body>
  {% include 'index.html' %}
<div class="container">
  <div class="page-header">
  <h2>Configure Data</h2>

  </div>
  <table border="0" cellspacing="8">
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td><label>Filter:</label></td>
    <td>
    <div class="input-group"><input type="text" id="txtPackageName" placeholder="Package Name" class="form-control"><span class="glyphicon glyphicon-search form-control-feedback"></span></input></div>
    </td>
    <td>&nbsp;</td>
    <td><div class="input-group"><input type="text" id="txtLanguage" placeholder="Language" class="form-control"><span class="glyphicon glyphicon-search form-control-feedback"></span></input></div></td>
    <td>&nbsp;</td>
    <td><div class="input-group"><input type="text" placeholder="Occurences" id="txtOccurrences" class="form-control"></input><span class="glyphicon glyphicon-search form-control-feedback"></span></div></td>
    <td>&nbsp;</td>
    <td><div class="input-group"><input type="text" id="txtCitations" placeholder="Citations"class="form-control"></input><span class="glyphicon glyphicon-search form-control-feedback"></span></div></td>
    <td>&nbsp;</td>
    <td><button type="button" id="btnSubmit" class="btn btn-primary">Search</button></td>
   <tr/>
 </table>
 <br/>
 <br/>
 <div id="chartdiv"></div>
<div class="table-responsive">
        <table class="table table-striped">
           <thead>
              <tr>
                <th>Select</th>
                <th>Package Name</th>
                <th>Version</th>
                <th>Hardware</th>
                <th>System</th>
                <th>Occurences</th>
              </tr>
           </thead> 
           <tbody>
           {% for key,value in data.items %}
            <tr>
               <td>
               <div id= "checkDiv">
                <input type="checkbox" name="chkData"  value = {{ value.package }} 
                {% if value.selected == "true" %} checked {%endif %}></input>
                </div>
               </td>
               <td>
                    {{ value.package }}
               </td>
               <td>
                    {{ value.version }}
               </td>
               <td>
                    {{ value.hardware }}
               </td>
               <td>
                    {{ value.system }}
               </td>
                <td>
                    {{ value.occurences }}
               </td>
            </tr>
             {% endfor %}
           </tbody>
       </table>
       <td><button type="button" id="save_button" class="btn btn-primary" onclick="saveChanges()">Save Changes</button>
 </div>
 </div>
</body>
</html>
