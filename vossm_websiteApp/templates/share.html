<!DOCTYPE html>
<html>
  <head>
    <title> Share Data</title>
  </head>
 <body>
{% include 'index.html' %}
 <div class="container">
 <div class="page-header">
  <h2>Share Data </h2
</div>
 <form action="" method="POST" id="share"> 
 {% csrf_token %}
 <table border="0" cellspacing="10">
 <tr>
     <td>
    <div class="checkbox">
    <label><input type="checkbox" value="chkTime" disabled>Time:</label>
    </div>
    </td>
    <td><div class="input-group"><input type="text" id="txtTime" class="form-control"></input></div></td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td><label>Share Data With:</label></td>
    <td><div class="input-group"><input type="text" class="form-control" placeholder=""></input></div></td>
 </table>
 <br/>
 <table border="0" cellspacing="10">
 <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td><label>Filter:</label></td>
    <td><div class="input-group"><input type="text" id="txtPackageName" name="txtPackageName"class="form-control" placeholder="Package Name"></input><span class="glyphicon glyphicon-search form-control-feedback"></span></div></td>
    <td>&nbsp;</td>
    <td><div class="input-group"><input placeholder="Language" type="text" id="txtLanguage" name="txtPackageName" class="form-control"></input><span class="glyphicon glyphicon-search form-control-feedback"></span></div></td>
    <td>&nbsp;</td>
    <td><div class="input-group"><input type="text" id="txtOccurrences" name="txtPackageName" placeholder="Occurrences" class="form-control"></input><span class="glyphicon glyphicon-search form-control-feedback"></span></div></td>
    <td>&nbsp;</td>
    <td><button type="button" id="btnSubmit" class="btn btn-primary" onclick="btnSubmit_click()">Search</button></td>
 <tr/>
 </table>
 <br/>
 <div class="table-responsive">
        <table id="table" name="table" class="table table-striped">
           <caption><b>Available Data</b></caption>
           <thead>
              <tr>
                <th>[]Select</th>
                <th>Package Name</th>
                <th>Version</th>
                <th>Language</th>
                <th>Occurrences</th>
              </tr>
           </thead> 
           <tbody>
             {% for key,value in data.items %}
             <tr>
              <td><input type="checkbox" value="chkData"></input></td>
              <td> {{ value.PackageName}}</td>
              <td> {{ value.Version}}</td>
              <td> {{ value.Language}}</td>
              <td> {{ value.Occurrences}}</td>
            </tr>
             {% endfor %}
           </tbody> 
       </table>
 </div>
</div>
</form>
 <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
 <script>
 function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function btnSubmit_click() {
   
    var csrftoken = getCookie('csrftoken');
    //alert(csrftoken);
    var txtPackageName=document.getElementById("txtPackageName").value;
    var txtOccurrences=document.getElementById("txtOccurrences").value;
    var txtLanguage=document.getElementById("txtLanguage").value;
   
    var ajaxData = {csrfmiddlewaretoken: csrftoken,'packageName' : txtPackageName,'occurrences':txtOccurrences,'language':txtLanguage};
          //'occurrences': txtOccurrences, 'Language': txtLanguage};
    
      $.ajaxSetup({
          beforeSend: function(xhr, settings) {
              if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                  xhr.setRequestHeader("X-CSRFToken", csrftoken);
              }
          }
      }); // to check if the csrf token is set - django 1.7 doc
    //alert();
    function csrfSafeMethod(method) {
          // these HTTP methods do not require CSRF protection
          return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
      }
      
   
    //alert(txtPackageName);
    $.ajax({
            url : "/filter/", // the endpoint
            headers: { 'Content-Type': 'application/json'},
            type : "POST", // http method
            dataType:"json",
            data : JSON.stringify(ajaxData), // data sent with the post request
    
            // handle a successful response
            success : function(json) {
                //console.log(json['result']); // log the returned json to the console
                console.log("success");
                console.log(json);
                //console.log(json['PackageN);
            },
    
            // handle a non-successful response
            error : function(xhr,errmsg,err) {
                console.log("Error!");
                console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
            }
      }); 

  }
 </script>
 </body>
 </html>